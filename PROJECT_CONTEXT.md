# Sv. Naum Calendar 2026 - Project Context

## Project Overview
Church calendar app for St. Naum Ohridski Church in Triengen, Switzerland.
- **React Native** with **Expo SDK 54**
- **Firebase** backend (Firestore + Auth)
- **Push notifications** via Expo
- **2026 calendar data** (87 church events)
- Supports iOS and Android

## Repository
- **GitHub**: https://github.com/gocko1004/SvNaumCalendar2026
- **Owner**: gocko1004
- **EAS Project ID**: ca6379d4-2b7a-4ea3-8aba-3a23414ae7cb

## ðŸš¨ URGENT: Windows Handoff Instructions (Jan 2, 2026)

**Goal**: Fix "App not installed" error on Pixel 7 (caused by key signature mismatch).

**Action Required on Windows Machine:**
1.  Connect Pixel 7 via USB.
2.  Open **Command Prompt** (cmd) or PowerShell.
3.  Run this command to clear the old app completely:
    ```bash
    adb uninstall com.svnaum.calendar
    ```
4.  If needed, install the new APK manually:
    ```bash
    adb install path/to/app.apk
    ```

**Note**: The APK link is: [https://expo.dev/artifacts/eas/rzcuEqhguhi3S2znmfHyyH.apk](https://expo.dev/artifacts/eas/rzcuEqhguhi3S2znmfHyyH.apk)

---

## ðŸ”‘ key Reset Status (Dec 27, 2025)
**Resolved**: The "Key Reset" issue is fixed.
- **New Key SHA-1**: `16:70:B5:36:99:99:73:96:20:96:B8:31:54:13:95:60:1C:12:12:5E`
- **Firebase Updated**: Yes, this SHA-1 is added to Firebase Console under Project Settings.
- **google-services.json**: Updated in repo (Dec 27).

---

## Recent Critical Events

### ðŸ”‘ Android Upload Key Reset
**Issue**: Original upload keystore password was lost.
**Action taken**:
1. Cancelled pending reset request from Dec 19.
2. Generated NEW upload key: `upload-key.jks`.
3. Submitted NEW reset request to Google Play Console.
4. Updated EAS credentials to use new key.
**Status**: **WAITING** for Google 48h approval (approx Dec 23).
**See**: `ANDROID_KEY_RESET_LOG.md` for passwords and details.

## Build Instructions

### On Mac (Local Build - RECOMMENDED)
```bash
# Clone the repo
git clone https://github.com/gocko1004/SvNaumCalendar2026.git
cd SvNaumCalendar2026

# Install dependencies
npm install

# Generate native projects
npx expo prebuild

# Run on iOS simulator
npx expo run:ios
```

### EAS Cloud Build (If needed)
```bash
# iOS
npx eas-cli build --platform ios --profile preview

# Android
npx eas-cli build --platform android --profile preview
```

## Important Files & Directories

### Source Code
- `src/services/NotificationService.ts` - Push notifications, yearly scheduling
- `src/services/ChurchCalendarService.ts` - 2026 calendar data (87 events)
- `src/services/DenoviImageService.ts` - Saint images from denovi.mk
- `src/firebase.js` - Firebase config (NOT TypeScript)
- `src/admin/` - Admin dashboard screens
- `src/screens/` - Main app screens

### Configuration
- `app.json` - Expo config
- `eas.json` - EAS Build config
- `metro.config.js` - Metro bundler (simplified)
- `tsconfig.json` - TypeScript config
- `.env` - Environment variables (not in git)

### Build Artifacts (Generated - DO NOT COMMIT)
- `ios/` - Native iOS project (generated by `expo prebuild`)
- `android/` - Native Android project (generated by `expo prebuild`)
- `node_modules/` - Dependencies

## Recent Issues Fixed (Dec 4, 2025)

### Critical Metro Bundler Error Fixed
**Problem**: iOS/Android builds failing with `context.fileSystemLookup is not a function` error during Metro bundling on EAS Build.

**Root Causes Found**:
1. `metro-core@^0.83.3` - incompatible version explicitly in dependencies
2. `@react-native-community/cli-server-api@^20.0.2` - pulling wrong Metro versions
3. Complex `metro.config.js` with SVG transformer causing conflicts
4. `postinstall` script running `patch-package`
5. Native `ios/` and `android/` directories with old configurations

**Fixes Applied**:
1. âœ… Removed `metro-core` from package.json
2. âœ… Removed `@react-native-community/cli-server-api` from package.json
3. âœ… Simplified `metro.config.js` to default Expo config (5 lines)
4. âœ… Removed `postinstall` script
5. âœ… Deleted native `ios/` and `android/` directories (will regenerate fresh)
6. âœ… Added iOS encryption exemption: `ITSAppUsesNonExemptEncryption: false`
7. âœ… Updated EAS preview profile for physical devices
8. âœ… Created `eas-hooks/eas-build-post-install.sh` for iOS sandboxing
