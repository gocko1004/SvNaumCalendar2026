# Sv. Naum Calendar 2026 - Project Context for Claude

## Project Overview
Church calendar app for St. Naum Ohridski Church in Triengen, Switzerland.
- **React Native** with **Expo SDK 51**
- **Firebase** backend (Firestore + Auth)
- **Push notifications** via Expo
- **2026 calendar data** (87 church events)
- Supports iOS and Android

## Repository
- **GitHub**: https://github.com/gocko1004/SvNaumCalendar2026
- **Owner**: gocko1004
- **EAS Project ID**: ca6379d4-2b7a-4ea3-8aba-3a23414ae7cb

## Recent Issues Fixed (Dec 4, 2025)

### Critical Metro Bundler Error Fixed
**Problem**: iOS/Android builds failing with `context.fileSystemLookup is not a function` error during Metro bundling on EAS Build.

**Root Causes Found**:
1. `metro-core@^0.83.3` - incompatible version explicitly in dependencies
2. `@react-native-community/cli-server-api@^20.0.2` - pulling wrong Metro versions
3. Complex `metro.config.js` with SVG transformer causing conflicts
4. `postinstall` script running `patch-package`
5. Native `ios/` and `android/` directories with old configurations

**Fixes Applied**:
1. ✅ Removed `metro-core` from package.json
2. ✅ Removed `@react-native-community/cli-server-api` from package.json
3. ✅ Simplified `metro.config.js` to default Expo config (5 lines)
4. ✅ Removed `postinstall` script
5. ✅ Deleted native `ios/` and `android/` directories (will regenerate fresh)
6. ✅ Added iOS encryption exemption: `ITSAppUsesNonExemptEncryption: false`
7. ✅ Updated EAS preview profile for physical devices
8. ✅ Created `eas-hooks/eas-build-post-install.sh` for iOS sandboxing

## Key Configuration Files

### package.json
```json
{
  "dependencies": {
    "expo": "~51.0.0",
    "react-native": "0.74.5",
    // NO metro-core
    // NO @react-native-community/cli-server-api
  }
}
```

### metro.config.js (SIMPLIFIED)
```javascript
const { getDefaultConfig } = require('@expo/metro-config');
const config = getDefaultConfig(__dirname);
module.exports = config;
```

### app.json
- iOS encryption: `ITSAppUsesNonExemptEncryption: false`
- Bundle ID: `com.svnaum.calendar`
- App name: "Св. Наум Охридски, Триенген" (Macedonian)

### eas.json
```json
{
  "build": {
    "preview": {
      "ios": {
        "simulator": false,
        "distribution": "internal",
        "image": "sdk-51"
      }
    }
  }
}
```

## Build Instructions

### On Mac (Local Build - RECOMMENDED)
```bash
# Clone the repo
git clone https://github.com/gocko1004/SvNaumCalendar2026.git
cd SvNaumCalendar2026

# Install dependencies
npm install

# Generate native projects
npx expo prebuild

# Run on iOS simulator
npx expo run:ios

# Or open in Xcode
open ios/SvNaumKalendar.xcworkspace
```

### EAS Cloud Build (If needed)
```bash
# iOS
npx eas-cli build --platform ios --profile preview

# Android
npx eas-cli build --platform android --profile preview
```

## Important Files & Directories

### Source Code
- `src/services/NotificationService.ts` - Push notifications, yearly scheduling
- `src/services/ChurchCalendarService.ts` - 2026 calendar data (87 events)
- `src/services/DenoviImageService.ts` - Saint images from denovi.mk
- `src/firebase.js` - Firebase config (NOT TypeScript)
- `src/admin/` - Admin dashboard screens
- `src/screens/` - Main app screens

### Configuration
- `app.json` - Expo config
- `eas.json` - EAS Build config
- `metro.config.js` - Metro bundler (simplified)
- `tsconfig.json` - TypeScript config
- `.env` - Environment variables (not in git)

### Build Artifacts (Generated - DO NOT COMMIT)
- `ios/` - Native iOS project (generated by `expo prebuild`)
- `android/` - Native Android project (generated by `expo prebuild`)
- `node_modules/` - Dependencies

## Known Issues & Solutions

### ❌ EAS Build Metro Error
**Status**: Attempted multiple fixes, kept failing
**Workaround**: Build locally on Mac with Xcode (more reliable)

### ⚠️ Metro Bundler Patches (scripts/fix-build-all.js)
**Note**: These patches are for LOCAL development only. NOT needed for builds.

### ⚠️ WSL2 Performance
Metro bundler very slow on Windows WSL2. Mac builds much faster.

## Environment Setup

### Required Tools
- Node.js 18+
- npm or yarn
- Xcode (Mac only, for iOS)
- Android Studio (for Android)
- EAS CLI: `npm install -g eas-cli`

### Environment Variables (.env)
```bash
API_AUTH_TOKEN=<your-token>
FACEBOOK_APP_ID=<optional>
FACEBOOK_APP_SECRET=<optional>
FACEBOOK_ACCESS_TOKEN=<optional>
```

## Firebase Setup
- **Project**: Sv Naum Calendar
- **Collections**:
  - `pushTokens` - Device tokens for notifications
  - `customEvents` - User-created events
- **Auth**: Email/password for admin access

## Testing Checklist
- [ ] Calendar displays 2026 events correctly
- [ ] Push notifications work
- [ ] Admin login functional
- [ ] Event creation saves to Firebase
- [ ] Saint images load from denovi.mk
- [ ] iOS build runs on physical device
- [ ] Android APK installs and runs

## Next Steps
1. Build on Mac with Xcode
2. Test on physical iPhone
3. Fix any remaining issues
4. Prepare for App Store submission

## Git Configuration
```bash
git config user.name "gocko1004"
git config user.email "goce1004@example.com"
```

## Useful Commands
```bash
# Check Expo doctor
npx expo-doctor

# Clear caches
npx expo start --clear

# TypeScript check
npx tsc --noEmit

# View EAS builds
npx eas-cli build:list
```

---
**Last Updated**: December 4, 2025
**Status**: Ready for Mac build testing
**Priority**: Test iOS build on Mac first
